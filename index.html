<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تفسير القرآن الكريم</title>
    <link rel="icon" href="image/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Eya2d/Wave-cloud/wave-cloud.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            height: 100dvh;           /* الأهم للتعامل مع الكيبورد */
            overflow: hidden;
            font-family: 'Cairo', sans-serif;
            background: #dee7ff;
        }
        body {
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .chat-container {
            width: 100%;
            max-width: 420px;
            height: 100dvh;
            margin: 0 auto;
            background: #f8f9ff;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.5s ease-out;
            position: relative;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== الهيدر ثابت في الأعلى ===== */
        .chat-header {
            background-color: #f8f9ff;
            color: white;
            padding: 16px;
            font-weight: 700;
            font-size: 1.2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            flex-shrink: 0;
            overflow: hidden;
            box-shadow: 0px 5px 7px #f8f9ff;
        }
        .chat-header::after {
            content: "";
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: linear-gradient(45deg, #d6baff30, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        .chat-header button {
            fill: #767ce8; color: #767ce8;
            background: #aca1ff26;
            border: none; border-radius: 30%;
            width: 36px; height: 36px;
            display: flex; align-items: center; justify-content: center;
        }
        .chat-header button:hover { background: #aca1ff42; }
        .chat-header .fffde {
            position: relative; z-index: 3;
            display: flex; align-items: center; justify-content: space-between;
            width: 100%; height: 100%;
        }
        .fffde-img { display: flex; align-items: center; direction: ltr; height: 0; }
        .fffde-img a {
            background: #fff; overflow: hidden;
            width: 40px; height: 40px; border-radius: 50%;
            margin: 0 -4px; outline: solid 2px #f8f9ff;
        }
        .fffde-img a img { height: 100%; }

        /* ===== منطقة الرسائل ===== */
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9ff;
            -webkit-overflow-scrolling: touch;
        }
        .message {
            user-select: none;
            font-size: 14px;
            margin: 10px 0;
            padding: 9px;
            border-radius: 18px;
            max-width: 69%;
            width: max-content;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
            position: relative;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message.user {
            background: #4e54c8;
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-top-right-radius: 4px;
            margin-right: 35px;
        }
        .message.user::after {
            content: '';
            position: absolute;
            background-image: url(image/yo.png);
            background-size: cover;
            filter: hue-rotate(36deg);
            right: 0; top: 0;
            margin: 0 -40px;
            width: 35px; height: 35px;
            border-radius: 25px;
            outline: 1px solid #ccc;
        }
        .message.bot {
            background: #e2e8f0;
            color: #2d3748;
            align-self: flex-start;
            margin-right: auto;
            border-top-left-radius: 4px;
            margin-left: 35px;
        }
        .message.bot::after {
            content: '';
            position: absolute;
            background-image: url(image/logo2.png);
            background-size: cover;
            filter: hue-rotate(36deg);
            top: 0; left: 0;
            margin: 0 -40px;
            width: 35px; height: 35px;
            border-radius: 25px;
            outline: 1px solid #cccccc;
            box-shadow: 0 0 0 1.7px #fff inset;
        }

        /* ===== منطقة الإدخال ثابتة في الأسفل ===== */
        .input-wrapper {
            position: sticky;
            bottom: 0;
            z-index: 90;
            background: #f8f9ff;
            padding: 10px;
            box-shadow: 0px -15px 20px #f8f9ff;
        }
        .search-box {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: transparent;
        }
        .search-box::after {
            content: "";
            position: absolute;
            bottom: 0;
            width: -webkit-fill-available;
            margin: auto 27px;
            height: 2px;
            background: linear-gradient(90deg, #4e54c8, #8f94fb);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }
        .search-box:focus-within::after {
            transform: scaleX(1);
            transform-origin: left;
        }
        .search-box input {
            padding: 14px 50px 14px 14px;
            width: 100%;
            border-radius: 30px;
            border: 1px solid #cbd5e0;
            font-size: 1rem;
            outline: none;
            background: white;
        }
        .search-box input:focus {
            border-color: #4e54c8;
            box-shadow: 0 0 0 3px rgba(78,84,200,0.1);
        }

        /* ===== الاقتراحات (suggestions) فوق الإنبوت ===== */
        .suggestions {
            position: absolute;
            bottom: 79px;
            left: 10px; right: 10px;
            background: white;
            border-radius: 20px;
            box-shadow: 0px -3px 7px #00000014, 0px 1px 2px #00000008;
            max-height: 280px;
            overflow-y: auto;
            z-index: 95;
            display: none;
        }
        .suggestions.show { display: flex; flex-direction: column; }
        .suggestions::after {
            content: 'مساعد ذكي';
            position: absolute;
            top: 0; right: 15px;
            margin: 10px;
            font-size: 0.85rem;
            color: #666;
        }
        .suggestions button {
            padding: 12px;
            margin: 0 10px;
            margin-top: 38px;
            background: #f1f5f9;
            border: 1px solid transparent;
            border-radius: 25px;
            text-align: right;
            font-size: 0.90rem;
            color: #4a5568;
        }
        .suggestions button:hover {
            background: #e2e8f0;
            border-color: #4e54c8;
        }
        .suggestions div:last-child { margin-bottom: 12px; }

        /* ===== زر الرجوع للأسفل ===== */
        .scr-top {
            position: absolute;
            bottom: 88px;
            right: 15px;
            z-index: 98;
            background: white;
            border: 1px solid #e2e8f0;
            width: 40px; height: 40px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        }
        .scr-top.show { display: flex; }

        /* ===== باقي الستايلات (القائمة السياقية، الـ typing، إلخ) ===== */
        .context-menu, .overlay { /* موجودة كما هي */ }
        .typing-indicator { /* موجودة كما هي */ }

        @media (max-width: 480px) {
            .chat-container { border-radius: 0; height: 100dvh; }
            .message { max-width: 85%; }
        }
    </style>
</head>
<body>

<div class="chat-container">
    <!-- الهيدر الثابت -->
    <div class="chat-header Wave-all-center">
        <div class="fffde">
            <button id="shareBtn"><ion-icon name="share-social-outline"></ion-icon></button>
            <div class="fffde-img">
                <a><img src="image/3.jpg" alt=""></a>
                <a style="z-index: 3;"><img src="image/2.jpg" alt=""></a>
                <a style="z-index: 5;"><img src="image/4.webp" alt=""></a>
            </div>
            <button id="newChatBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M8 0.599609C3.91309 0.599609 0.599609 3.91309 0.599609 8C0.599609 9.13376 0.855461 10.2098 1.3125 11.1719L1.5918 11.7588L2.76562 11.2012L2.48633 10.6143C2.11034 9.82278 1.90039 8.93675 1.90039 8C1.90039 4.63106 4.63106 1.90039 8 1.90039C11.3689 1.90039 14.0996 4.63106 14.0996 8C14.0996 11.3689 11.3689 14.0996 8 14.0996C7.31041 14.0996 6.80528 14.0514 6.35742 13.9277C5.91623 13.8059 5.49768 13.6021 4.99707 13.2529C4.26492 12.7422 3.21611 12.5616 2.35156 13.1074L2.33789 13.1162L2.32422 13.126L1.58789 13.6436L2.01953 14.9297L3.0459 14.207C3.36351 14.0065 3.83838 14.0294 4.25293 14.3184C4.84547 14.7317 5.39743 15.011 6.01172 15.1807C6.61947 15.3485 7.25549 15.4004 8 15.4004C12.0869 15.4004 15.4004 12.0869 15.4004 8C15.4004 3.91309 12.0869 0.599609 8 0.599609ZM7.34473 4.93945V7.34961H4.93945V8.65039H7.34473V11.0605H8.64551V8.65039H11.0605V7.34961H8.64551V4.93945H7.34473Z" fill="currentColor"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- الرسائل -->
    <div class="messages" id="messages"></div>

    <!-- الاقتراحات -->
    <div class="suggestions Wave-all" id="suggestions"></div>

    <!-- منطقة الإدخال الثابتة في الأسفل -->
    <div class="input-wrapper">
        <div class="search-box">
            <input type="search" id="searchInput" placeholder="اكتب سؤالك هنا..." autofocus>
        </div>
    </div>

    <!-- زر الرجوع للأسفل -->
    <button class="scr-top Wave-center" id="scrollToBottomBtn">
        <ion-icon name="arrow-down-outline"></ion-icon>
    </button>
</div>

<!-- القائمة السياقية وطبقة التعتيم (تبقى كما هي) -->
<div id="contextMenu" class="context-menu Wave-all">
    <button id="searchWebBtn"><span>بحث في الويب</span></button>
    <button id="copyTextBtn"><span>نسخ النص</span></button>
    <div class="divider"></div>
    <button id="shareTextBtn"><span>مشاركة النص</span></button>
</div>
<div id="overlay" class="overlay"></div>

<script src="script.js"></script>
<script src="data.js"></script>

<!-- جافاسكربت بسيط لزر الرجوع للأسفل + إظهار الاقتراحات عند الحاجة -->
<script>
    const messagesDiv = document.getElementById('messages');
    const scrollBtn = document.getElementById('scrollToBottomBtn');
    const suggestions = document.getElementById('suggestions');

    messagesDiv.addEventListener('scroll', () => {
        const isNearBottom = messagesDiv.scrollHeight - messagesDiv.clientHeight <= messagesDiv.scrollTop + 100;
        scrollBtn.classList.toggle('show', !isNearBottom);
    });

    scrollBtn.addEventListener('click', () => {
        messagesDiv.scrollTo({ top: messagesDiv.scrollHeight, behavior: 'smooth' });
    });

    // مثال بسيط لإظهار الاقتراحات (يمكنك تعديله في script.js)
    document.getElementById('searchInput').addEventListener('focus', () => {
        if (suggestions.children.length > 0) suggestions.classList.add('show');
    });
    document.getElementById('searchInput').addEventListener('blur', () => {
        setTimeout(() => suggestions.classList.remove('show'), 200);
    });
</script>

</body>
</html>
